{% extends 'modern_dashboard_base.html' %}
{% load static %}

{% block title %}Planning des Formations{% endblock %}

{% block extra_css %}
<style>
    .calendar-header {
        background: linear-gradient(135deg, #2E8B57, #228B22);
        color: white;
        padding: 20px;
        border-radius: 15px 15px 0 0;
    }
    
    .calendar-grid {
        display: grid;
        grid-template-columns: repeat(7, 1fr);
        gap: 1px;
        background: #dee2e6;
        border-radius: 0 0 15px 15px;
        overflow: hidden;
    }
    
    .calendar-day {
        background: white;
        min-height: 120px;
        padding: 10px;
        position: relative;
        transition: all 0.3s ease;
    }
    
    .calendar-day:hover {
        background: #f8f9fa;
        transform: scale(1.02);
        z-index: 10;
        box-shadow: 0 5px 15px rgba(0,0,0,0.1);
    }
    
    .calendar-day.other-month {
        background: #f8f9fa;
        color: #6c757d;
    }
    
    .calendar-day.today {
        background: linear-gradient(135deg, #2E8B57, #228B22);
        color: white;
    }
    
    .day-number {
        font-weight: bold;
        margin-bottom: 5px;
    }
    
    .session-item {
        background: linear-gradient(135deg, #007bff, #0056b3);
        color: white;
        padding: 3px 6px;
        border-radius: 4px;
        font-size: 0.75rem;
        margin-bottom: 2px;
        cursor: pointer;
        transition: all 0.3s ease;
    }
    
    .session-item:hover {
        transform: scale(1.05);
    }
    
    .session-item.formation-dev { background: linear-gradient(135deg, #28a745, #20c997); }
    .session-item.formation-marketing { background: linear-gradient(135deg, #ffc107, #fd7e14); }
    .session-item.formation-design { background: linear-gradient(135deg, #e83e8c, #dc3545); }
    .session-item.formation-gestion { background: linear-gradient(135deg, #6f42c1, #495057); }
    
    .week-header {
        background: #495057;
        color: white;
        padding: 15px;
        text-align: center;
        font-weight: 600;
    }
    
    .schedule-stats {
        background: white;
        border-radius: 15px;
        padding: 20px;
        box-shadow: 0 5px 15px rgba(0,0,0,0.08);
        margin-bottom: 20px;
    }
    
    .time-slot {
        background: #f8f9fa;
        border-left: 4px solid #2E8B57;
        padding: 15px;
        margin-bottom: 10px;
        border-radius: 0 10px 10px 0;
        transition: all 0.3s ease;
    }
    
    .time-slot:hover {
        background: #e9ecef;
        transform: translateX(5px);
    }
</style>
{% endblock %}

{% block content %}
<div class="container-fluid">
    <!-- Page Header -->
    <div class="d-flex justify-content-between align-items-center mb-4">
        <div>
            <h2 class="mb-1">
                <i class="fas fa-calendar-alt me-2 text-primary"></i>
                Planning des Formations
            </h2>
            <p class="text-muted mb-0">Janvier 2024 - Centre de Formation Al Manar</p>
        </div>
        <div>
            <button class="btn btn-primary me-2" data-bs-toggle="modal" data-bs-target="#addSessionModal">
                <i class="fas fa-plus me-1"></i>
                Nouvelle Session
            </button>
            <div class="btn-group">
                <button class="btn btn-outline-secondary active">Mois</button>
                <button class="btn btn-outline-secondary">Semaine</button>
                <button class="btn btn-outline-secondary">Jour</button>
            </div>
        </div>
    </div>

    <!-- Statistics Row -->
    <div class="row mb-4">
        <div class="col-md-3">
            <div class="schedule-stats text-center">
                <i class="fas fa-clock fa-2x text-primary mb-2"></i>
                <h4>{{ total_sessions|default:45 }}</h4>
                <small class="text-muted">Sessions ce mois</small>
            </div>
        </div>
        <div class="col-md-3">
            <div class="schedule-stats text-center">
                <i class="fas fa-users fa-2x text-success mb-2"></i>
                <h4>{{ active_formations|default:8 }}</h4>
                <small class="text-muted">Formations actives</small>
            </div>
        </div>
        <div class="col-md-3">
            <div class="schedule-stats text-center">
                <i class="fas fa-chalkboard-teacher fa-2x text-warning mb-2"></i>
                <h4>{{ active_trainers|default:12 }}</h4>
                <small class="text-muted">Formateurs actifs</small>
            </div>
        </div>
        <div class="col-md-3">
            <div class="schedule-stats text-center">
                <i class="fas fa-door-open fa-2x text-info mb-2"></i>
                <h4>{{ available_rooms|default:6 }}</h4>
                <small class="text-muted">Salles disponibles</small>
            </div>
        </div>
    </div>

    <!-- Calendar -->
    <div class="card" data-aos="fade-up">
        <div class="calendar-header">
            <div class="d-flex justify-content-between align-items-center">
                <div>
                    <h4 class="mb-0">Janvier 2024</h4>
                    <small class="opacity-75">Planning mensuel des formations</small>
                </div>
                <div>
                    <button class="btn btn-light btn-sm me-2">
                        <i class="fas fa-chevron-left"></i>
                    </button>
                    <button class="btn btn-light btn-sm">
                        <i class="fas fa-chevron-right"></i>
                    </button>
                </div>
            </div>
        </div>
        
        <!-- Week Headers -->
        <div class="calendar-grid">
            <div class="week-header">Lun</div>
            <div class="week-header">Mar</div>
            <div class="week-header">Mer</div>
            <div class="week-header">Jeu</div>
            <div class="week-header">Ven</div>
            <div class="week-header">Sam</div>
            <div class="week-header">Dim</div>
            
            <!-- Calendar Days -->
            <div class="calendar-day other-month">
                <div class="day-number">31</div>
            </div>
            
            {% for day in "123456789012345678901234567890123" %}
            <div class="calendar-day {% if day == '15' %}today{% endif %}">
                <div class="day-number">{{ forloop.counter }}</div>
                
                {% if forloop.counter == 2 %}
                    <div class="session-item formation-dev" data-bs-toggle="tooltip" title="Développement Web - Groupe A">
                        09:00 Dev Web A
                    </div>
                    <div class="session-item formation-marketing" data-bs-toggle="tooltip" title="Marketing Digital - Groupe B">
                        14:00 Marketing B
                    </div>
                {% elif forloop.counter == 3 %}
                    <div class="session-item formation-design" data-bs-toggle="tooltip" title="Design Graphique - Groupe C">
                        10:00 Design C
                    </div>
                {% elif forloop.counter == 5 %}
                    <div class="session-item formation-dev" data-bs-toggle="tooltip" title="Développement Web - Groupe B">
                        09:00 Dev Web B
                    </div>
                    <div class="session-item formation-gestion" data-bs-toggle="tooltip" title="Gestion de Projet">
                        15:00 Gestion
                    </div>
                {% elif forloop.counter == 8 %}
                    <div class="session-item formation-marketing" data-bs-toggle="tooltip" title="Marketing Digital - Groupe A">
                        09:00 Marketing A
                    </div>
                {% elif forloop.counter == 10 %}
                    <div class="session-item formation-dev" data-bs-toggle="tooltip" title="Développement Web - Groupe A">
                        09:00 Dev Web A
                    </div>
                    <div class="session-item formation-design" data-bs-toggle="tooltip" title="Design Graphique - Groupe C">
                        14:00 Design C
                    </div>
                {% elif forloop.counter == 12 %}
                    <div class="session-item formation-gestion" data-bs-toggle="tooltip" title="Gestion de Projet">
                        10:00 Gestion
                    </div>
                {% elif forloop.counter == 15 %}
                    <div class="session-item formation-dev" data-bs-toggle="tooltip" title="Développement Web - Groupe B">
                        09:00 Dev Web B
                    </div>
                    <div class="session-item formation-marketing" data-bs-toggle="tooltip" title="Marketing Digital - Groupe B">
                        14:00 Marketing B
                    </div>
                    <div class="session-item formation-design" data-bs-toggle="tooltip" title="Design Graphique - Atelier">
                        16:00 Design Atelier
                    </div>
                {% elif forloop.counter == 17 %}
                    <div class="session-item formation-marketing" data-bs-toggle="tooltip" title="Marketing Digital - Groupe A">
                        09:00 Marketing A
                    </div>
                {% elif forloop.counter == 19 %}
                    <div class="session-item formation-dev" data-bs-toggle="tooltip" title="Développement Web - Groupe A">
                        09:00 Dev Web A
                    </div>
                    <div class="session-item formation-gestion" data-bs-toggle="tooltip" title="Gestion de Projet">
                        15:00 Gestion
                    </div>
                {% elif forloop.counter == 22 %}
                    <div class="session-item formation-design" data-bs-toggle="tooltip" title="Design Graphique - Groupe C">
                        10:00 Design C
                    </div>
                    <div class="session-item formation-marketing" data-bs-toggle="tooltip" title="Marketing Digital - Groupe B">
                        14:00 Marketing B
                    </div>
                {% elif forloop.counter == 24 %}
                    <div class="session-item formation-dev" data-bs-toggle="tooltip" title="Développement Web - Groupe B">
                        09:00 Dev Web B
                    </div>
                {% elif forloop.counter == 26 %}
                    <div class="session-item formation-gestion" data-bs-toggle="tooltip" title="Gestion de Projet">
                        10:00 Gestion
                    </div>
                    <div class="session-item formation-marketing" data-bs-toggle="tooltip" title="Marketing Digital - Groupe A">
                        15:00 Marketing A
                    </div>
                {% elif forloop.counter == 29 %}
                    <div class="session-item formation-dev" data-bs-toggle="tooltip" title="Développement Web - Groupe A">
                        09:00 Dev Web A
                    </div>
                    <div class="session-item formation-design" data-bs-toggle="tooltip" title="Design Graphique - Groupe C">
                        14:00 Design C
                    </div>
                {% elif forloop.counter == 31 %}
                    <div class="session-item formation-marketing" data-bs-toggle="tooltip" title="Marketing Digital - Groupe B">
                        09:00 Marketing B
                    </div>
                {% endif %}
            </div>
            {% endfor %}
            
            <div class="calendar-day other-month">
                <div class="day-number">1</div>
            </div>
            <div class="calendar-day other-month">
                <div class="day-number">2</div>
            </div>
            <div class="calendar-day other-month">
                <div class="day-number">3</div>
            </div>
            <div class="calendar-day other-month">
                <div class="day-number">4</div>
            </div>
        </div>
    </div>

    <!-- Today's Schedule -->
    <div class="row mt-4">
        <div class="col-md-8">
            <div class="card" data-aos="fade-up" data-aos-delay="200">
                <div class="card-header bg-primary text-white">
                    <h5 class="mb-0">
                        <i class="fas fa-calendar-day me-2"></i>
                        Planning d'aujourd'hui - 15 Janvier 2024
                    </h5>
                </div>
                <div class="card-body">
                    <div class="time-slot">
                        <div class="d-flex justify-content-between align-items-center">
                            <div>
                                <strong>09:00 - 12:00</strong>
                                <h6 class="mb-1">Développement Web - Groupe B</h6>
                                <small class="text-muted">Salle 101 • M. Alami • 18 étudiants</small>
                            </div>
                            <span class="badge bg-success">En cours</span>
                        </div>
                    </div>
                    
                    <div class="time-slot">
                        <div class="d-flex justify-content-between align-items-center">
                            <div>
                                <strong>14:00 - 17:00</strong>
                                <h6 class="mb-1">Marketing Digital - Groupe B</h6>
                                <small class="text-muted">Salle 203 • Mme Bennani • 15 étudiants</small>
                            </div>
                            <span class="badge bg-warning">À venir</span>
                        </div>
                    </div>
                    
                    <div class="time-slot">
                        <div class="d-flex justify-content-between align-items-center">
                            <div>
                                <strong>16:00 - 18:00</strong>
                                <h6 class="mb-1">Design Graphique - Atelier Pratique</h6>
                                <small class="text-muted">Salle 105 • M. Tazi • 12 étudiants</small>
                            </div>
                            <span class="badge bg-info">Atelier</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="col-md-4">
            <div class="card" data-aos="fade-up" data-aos-delay="300">
                <div class="card-header bg-secondary text-white">
                    <h6 class="mb-0">
                        <i class="fas fa-info-circle me-2"></i>
                        Informations Utiles
                    </h6>
                </div>
                <div class="card-body">
                    <div class="mb-3">
                        <strong>Salles disponibles:</strong><br>
                        <small class="text-success">• Salle 102, 104, 201, 202</small>
                    </div>
                    
                    <div class="mb-3">
                        <strong>Formateurs libres:</strong><br>
                        <small class="text-info">• Mme Fassi, M. Idrissi</small>
                    </div>
                    
                    <div class="mb-3">
                        <strong>Prochaines sessions:</strong><br>
                        <small class="text-warning">• 17 Jan: Nouvelle session Cybersécurité</small><br>
                        <small class="text-warning">• 22 Jan: Atelier Design Avancé</small>
                    </div>
                    
                    <hr>
                    
                    <div class="text-center">
                        <button class="btn btn-sm btn-outline-primary">
                            <i class="fas fa-print me-1"></i>
                            Imprimer Planning
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Add Session Modal -->
<div class="modal fade" id="addSessionModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header bg-primary text-white">
                <h5 class="modal-title">
                    <i class="fas fa-plus me-2"></i>
                    Nouvelle Session
                </h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <form id="addSessionForm" class="needs-validation" novalidate>
                    <div class="mb-3">
                        <label class="form-label">Formation *</label>
                        <select class="form-select" required>
                            <option value="">Sélectionner une formation</option>
                            <option value="dev-web">Développement Web Full Stack</option>
                            <option value="marketing">Marketing Digital</option>
                            <option value="design">Design Graphique</option>
                            <option value="gestion">Gestion de Projet</option>
                        </select>
                    </div>
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label class="form-label">Date *</label>
                            <input type="date" class="form-control" required>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label">Heure de début *</label>
                            <input type="time" class="form-control" required>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label class="form-label">Durée (heures)</label>
                            <select class="form-select">
                                <option value="2">2 heures</option>
                                <option value="3" selected>3 heures</option>
                                <option value="4">4 heures</option>
                                <option value="6">6 heures</option>
                            </select>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label">Salle</label>
                            <select class="form-select">
                                <option value="">Sélectionner une salle</option>
                                <option value="101">Salle 101</option>
                                <option value="102">Salle 102</option>
                                <option value="201">Salle 201</option>
                                <option value="203">Salle 203</option>
                            </select>
                        </div>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Formateur</label>
                        <select class="form-select">
                            <option value="">Sélectionner un formateur</option>
                            <option value="1">Mohammed Alami</option>
                            <option value="2">Fatima Bennani</option>
                            <option value="3">Youssef Tazi</option>
                            <option value="4">Aicha Fassi</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Notes</label>
                        <textarea class="form-control" rows="2" placeholder="Notes additionnelles..."></textarea>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Annuler</button>
                <button type="button" class="btn btn-primary btn-loading" onclick="saveSession()">
                    <i class="fas fa-save me-1"></i>
                    Programmer
                </button>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
function saveSession() {
    const form = document.getElementById('addSessionForm');
    if (form.checkValidity()) {
        // Simulate saving
        setTimeout(() => {
            Utils.showToast('Session programmée avec succès!', 'success');
            bootstrap.Modal.getInstance(document.getElementById('addSessionModal')).hide();
            form.reset();
            location.reload();
        }, 2000);
    } else {
        form.classList.add('was-validated');
    }
}

// Initialize tooltips
document.addEventListener('DOMContentLoaded', function() {
    var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
    var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
        return new bootstrap.Tooltip(tooltipTriggerEl);
    });
});
</script>
{% endblock %}